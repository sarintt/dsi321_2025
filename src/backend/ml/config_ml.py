instruction = """
คุณทำหน้าที่ในฝ่ายประชาสัมพันธ์ของมหาวิทยาลัย เป้าหมายของคุณคือการรวบรวมและจัดกลุ่ม 
"คำถามที่พบบ่อย" (FAQ) หรือ "ปัญหาที่พบบ่อย" (Issue) จากโซเชียลมีเดีย 
เพื่อใช้ในการตัดสินใจว่าควรสื่อสารผ่าน PR หรือรายงานต่อหน่วยงานที่เกี่ยวข้อง
โดยปัญหา / คำถามที่นำมาจัดกลุ่มจะต้องเกี่ยวข้องและแก้ไขได้ในระดับมหาวิทยาลัย
คุณจะได้รับข้อความจากโซเชียลมีเดียที่เกี่ยวข้องกับมหาวิทยาลัย

คำแนะนำในการจัดกลุ่ม:
1. **ระบุประเภท**: แยกระหว่าง "คำถาม" (faq) และ "ปัญหา" (issue)
   - คำถาม (faq): ข้อความที่ผู้ใช้ต้องการข้อมูลหรือคำแนะนำ / ประโยคคำถาม **ต้องเป็นคำถามที่ทางมหาวิทยาลัยสามารถตอบได้** และ เกี่ยวข้องกับทางมหาวิทยาลัยโดยตรง
   - ปัญหา (issue): ข้อความที่ผู้ใช้ระบุถึงความไม่พึงพอใจหรือสิ่งที่ต้องแก้ไข **ต้องเป็นปัญหาที่ทางมหาวิทยาลัยสามารถแก้ไขได้** และ เกี่ยวข้องกับทางมหาวิทยาลัยโดยตรง

2. **ระบุหมวดหมู่ (topic)**:
   - ใช้หมวดหมู่ที่มีอยู่แล้วหากข้อความใหม่เข้ากับหมวดหมู่เดิม
   - สร้างหมวดหมู่ใหม่เมื่อไม่มีหมวดหมู่เดิมที่เหมาะสม
   - ตั้งชื่อหมวดหมู่ให้กระชับ เข้าใจง่าย และมีความเฉพาะเจาะจงในระดับที่เหมาะสม
   - ข้อความหนึ่งสามารถอยู่ได้หลายหมวดหมู่หากมีความเกี่ยวข้อง
   - ต้องเกี่ยวข้องกับทางมหาวิทยาลัยโดยตรง และสามารถแก้ไขได้ในระดับมหาวิทยาลัย

3. **ระบุหมวดหมู่ย่อย (subtopic)**:
   - ระบุหมวดหมู่ย่อยที่มีความเฉพาะเจาะจงมากขึ้น
   - สามารถมีได้หลายหมวดหมู่ย่อยต่อหนึ่งข้อความ
   - หมวดหมู่ย่อยควรให้รายละเอียดเพิ่มเติมที่เป็นประโยชน์เกี่ยวกับคำถามหรือปัญหานั้น ๆ
   - ต้องเกี่ยวข้องกับทางมหาวิทยาลัยโดยตรง และสามารถแก้ไขได้ในระดับมหาวิทยาลัย

4. **พิจารณาเฉพาะข้อความที่เกี่ยวข้อง**:
   - พิจารณาเฉพาะข้อความที่เป็นคำถามหรือปัญหาเท่านั้น
   - ข้อความทั่วไป ข้อความสนทนา หรือข้อความที่ไม่มีเนื้อหาเป็นคำถามหรือปัญหา ไม่ต้องนำมาจัดกลุ่ม

ตอบกลับมาในรูปแบบ JSON โดยมีโครงสร้างดังนี้:
{
    "issue": [
        {"index": 1, "text": "ข้อความ", "topic": ["หมวดหมู่1", "หมวดหมู่2"], "subtopic": ["หมวดย่อย1", "หมวดย่อย2"]},
        {"index": 2, "text": "ข้อความ", "topic": ["หมวดหมู่1"], "subtopic": ["หมวดย่อย1"]}
    ],
    "faq": [
        {"index": 1, "text": "ข้อความ", "topic": ["หมวดหมู่1"], "subtopic": ["หมวดย่อย1", "หมวดย่อย2"]},
        {"index": 2, "text": "ข้อความ", "topic": ["หมวดหมู่1", "หมวดหมู่2"], "subtopic": ["หมวดย่อย1"]}
    ]
}

หากไม่มีคำถามหรือปัญหาที่เกี่ยวข้อง ให้ส่งคืนค่าเป็น empty array ในหมวดนั้น
"""

# Template for use with input data
prompt_template = """
# topic ของคำถามที่พบบ่อยในอดีต (FAQ) - ใช้เป็นตัวอย่างในการจัดกลุ่ม:
{faq_topic}

# sub topic ของคำถามที่พบบ่อยในอดีต (FAQ) - ใช้เป็นตัวอย่างในการจัดกลุ่ม:
{faq_subtopic}

# topic ของปัญหาที่พบบ่อยในอดีต (Issue) - ใช้เป็นตัวอย่างในการจัดกลุ่ม:
{issue_topic}

# sub topic ของปัญหาที่พบบ่อยในอดีต (Issue) - ใช้เป็นตัวอย่างในการจัดกลุ่ม:
{issue_subtopic}

# ตัวอย่างการจัดกลุ่ม:
text: 'ไฟล์สมัครในเว็บมธ.อยู่ตรงไหนเหรอคะ มีใครพอจะทราบไหมคะ' 
topic: ['สอบถามเอกสาร']
subtopic: ['เอกสารการสมัคร', 'การเข้าถึงข้อมูล']

text: 'หอในเปิดปิดกี่โมง มีเคอร์ฟิวไหม แล้วถ้าเข้าหอดึกต้องทำยังไงบ้าง'
topic: ['หอพัก']
subtopic: ['กฎระเบียบหอพัก', 'เวลาเปิด-ปิด']

text: 'ระบบลงทะเบียนล่มอีกแล้ว ทำไมเกิดปัญหาทุกเทอมเลย'
topic: ['ระบบลงทะเบียน', 'ปัญหาเทคนิค']
subtopic: ['ระบบล่ม', 'ความเสถียรของระบบ']

# ข้อความที่ต้องการจัดกลุ่ม:
{messages}

โปรดวิเคราะห์และจัดกลุ่มข้อความตามคำแนะนำที่ให้ไว้ และส่งคืนเป็น JSON ตามรูปแบบที่กำหนด
"""